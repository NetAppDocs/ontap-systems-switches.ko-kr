---
permalink: switch-cisco-9336c-fx2/migrate-to-switchless-interconnect-9336-cluster.html 
sidebar: sidebar 
keywords: migrate, switchless cluster interconnect, cisco nexus switch 9336C-FX2 
summary: ONTAP 9.3 이상에서는 스위치드 클러스터 네트워크가 있는 클러스터에서 두 개의 노드가 직접 연결된 클러스터로 마이그레이션할 수 있습니다. 
---
= Cisco Nexus 9336C-FX2 및 9336C-FX2-T 클러스터 스위치를 스위치리스 연결로 교체
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.3 이상에서는 스위치드 클러스터 네트워크가 있는 클러스터에서 두 개의 노드가 직접 연결된 클러스터로 마이그레이션할 수 있습니다.



== 검토 요구 사항

.가이드라인
다음 지침을 검토하세요.

* 2노드 스위치리스 클러스터 구성으로 마이그레이션하는 작업은 중단 없이 진행됩니다.  대부분의 시스템은 각 노드에 전용 클러스터 상호 연결 포트가 두 개 있지만, 각 노드에 전용 클러스터 상호 연결 포트가 4개, 6개 또는 8개 등 더 많은 수의 시스템에도 이 절차를 사용할 수 있습니다.
* 두 개 이상의 노드에서는 스위치리스 클러스터 상호 연결 기능을 사용할 수 없습니다.
* 클러스터 상호 연결 스위치를 사용하고 ONTAP 9.3 이상을 실행하는 기존의 2노드 클러스터가 있는 경우, 스위치를 노드 간에 직접적이고 연속적인 연결로 교체할 수 있습니다.


.시작하기 전에
다음 사항이 있는지 확인하세요.

* 클러스터 스위치로 연결된 두 개의 노드로 구성된 건강한 클러스터입니다.  노드는 동일한 ONTAP 릴리스를 실행해야 합니다.
* 각 노드에는 필요한 수의 전용 클러스터 포트가 있으며, 이를 통해 시스템 구성을 지원하는 중복 클러스터 상호 연결 연결이 제공됩니다.  예를 들어, 각 노드에 전용 클러스터 상호 연결 포트가 두 개 있는 시스템에는 중복 포트가 두 개 있습니다.




== 스위치 마이그레이션

.이 작업에 관하여
다음 절차에서는 2노드 클러스터에서 클러스터 스위치를 제거하고 스위치에 대한 각 연결을 파트너 노드에 대한 직접 연결로 교체합니다.

image::../media/tnsc_clusterswitches_and_direct_connections.PNG[클러스터 스위치가 직접 연결로 교체됨]

.예시에 관하여
다음 절차의 예에서는 "e0a"와 "e0b"를 클러스터 포트로 사용하는 노드를 보여줍니다.  시스템에 따라 노드가 서로 다른 클러스터 포트를 사용하고 있을 수 있습니다.



=== 1단계: 마이그레이션 준비

. 권한 수준을 고급으로 변경하려면 다음을 입력하세요. `y` 계속하라는 메시지가 표시되면:
+
`set -privilege advanced`

+
고급 프롬프트 `*>` 나타납니다.

. ONTAP 9.3 이상에서는 스위치 없는 클러스터의 자동 감지 기능이 기본적으로 활성화되어 있습니다.
+
고급 권한 명령을 실행하여 스위치리스 클러스터 감지가 활성화되었는지 확인할 수 있습니다.

+
`network options detect-switchless-cluster show`

+
.예를 보여주세요
[%collapsible]
====
다음 예제 출력은 해당 옵션이 활성화되어 있는지 여부를 보여줍니다.

[listing]
----
cluster::*> network options detect-switchless-cluster show
   (network options detect-switchless-cluster show)
Enable Switchless Cluster Detection: true
----
====
+
"스위치리스 클러스터 감지 활성화"가 설정된 경우 `false` NetApp 지원팀에 문의하세요.

. 이 클러스터에서 AutoSupport 활성화된 경우 AutoSupport 메시지를 호출하여 자동 케이스 생성을 억제합니다.
+
`system node autosupport invoke -node * -type all -message MAINT=<number_of_hours>h`

+
어디 `h` 유지 관리 기간의 시간 단위입니다.  이 메시지는 기술 지원팀에 이 유지 관리 작업을 알려 유지 관리 기간 동안 자동 케이스 생성을 억제할 수 있도록 합니다.

+
다음 예에서 명령은 2시간 동안 자동 사례 생성을 억제합니다.

+
.예를 보여주세요
[%collapsible]
====
[listing]
----
cluster::*> system node autosupport invoke -node * -type all -message MAINT=2h
----
====




=== 2단계: 포트 및 케이블 구성

. 각 스위치의 클러스터 포트를 그룹으로 구성하여 그룹1의 클러스터 포트가 클러스터 스위치1로 연결되고 그룹2의 클러스터 포트가 클러스터 스위치2로 연결되도록 합니다.  이러한 그룹은 절차의 후반부에 필요합니다.
. 클러스터 포트를 식별하고 링크 상태와 상태를 확인합니다.
+
`network port show -ipspace Cluster`

+
클러스터 포트가 "e0a" 및 "e0b"인 노드의 다음 예에서 한 그룹은 "node1:e0a" 및 "node2:e0a"로 식별되고 다른 그룹은 "node1:e0b" 및 "node2:e0b"로 식별됩니다.  시스템에 따라 노드가 서로 다른 클러스터 포트를 사용하고 있을 수 있습니다.

+
image::../media/tnsc_clusterswitch_connections.PNG[노드1과 노드2 사이의 클러스터 스위치 연결]

+
포트에 값이 있는지 확인하세요. `up` "링크" 열과 값에 대해 `healthy` "건강 상태" 열에 대해.

+
.예를 보여주세요
[%collapsible]
====
[listing]
----
cluster::> network port show -ipspace Cluster
Node: node1
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false

Node: node2
                                                                 Ignore
                                             Speed(Mbps) Health  Health
Port  IPspace   Broadcast Domain Link  MTU   Admin/Oper	 Status  Status
----- --------- ---------------- ----- ----- ----------- ------- -------
e0a   Cluster   Cluster          up    9000  auto/10000  healthy false
e0b   Cluster   Cluster          up    9000  auto/10000  healthy false
4 entries were displayed.
----
====
. 모든 클러스터 LIF가 홈 포트에 있는지 확인하세요.
+
"is-home" 열이 있는지 확인하십시오. `true` 각 클러스터 LIF에 대해:

+
`network interface show -vserver Cluster -fields is-home`

+
.예를 보여주세요
[%collapsible]
====
[listing]
----
cluster::*> net int show -vserver Cluster -fields is-home
(network interface show)
vserver  lif          is-home
-------- ------------ --------
Cluster  node1_clus1  true
Cluster  node1_clus2  true
Cluster  node2_clus1  true
Cluster  node2_clus2  true
4 entries were displayed.
----
====
+
홈 포트에 없는 클러스터 LIF가 있는 경우 해당 LIF를 홈 포트로 되돌립니다.

+
`network interface revert -vserver Cluster -lif *`

. 클러스터 LIF에 대한 자동 되돌리기를 비활성화합니다.
+
`network interface modify -vserver Cluster -lif * -auto-revert false`

. 이전 단계에 나열된 모든 포트가 네트워크 스위치에 연결되어 있는지 확인하세요.
+
`network device-discovery show -port _cluster_port_`

+
"검색된 장치" 열은 포트가 연결된 클러스터 스위치의 이름이어야 합니다.

+
.예를 보여주세요
[%collapsible]
====
다음 예에서는 클러스터 포트 "e0a"와 "e0b"가 클러스터 스위치 "cs1"과 "cs2"에 올바르게 연결되어 있음을 보여줍니다.

[listing]
----
cluster::> network device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/     Local  Discovered
Protocol  Port   Device (LLDP: ChassisID)  Interface  Platform
--------- ------ ------------------------- ---------- ----------
node1/cdp
          e0a    cs1                       0/11       BES-53248
          e0b    cs2                       0/12       BES-53248
node2/cdp
          e0a    cs1                       0/9        BES-53248
          e0b    cs2                       0/9        BES-53248
4 entries were displayed.
----
====
. 원격 클러스터 인터페이스의 연결성을 확인하세요.


[role="tabbed-block"]
====
.ONTAP 9.9.1 이상
--
당신은 사용할 수 있습니다 `network interface check cluster-connectivity` 클러스터 연결에 대한 접근성 검사를 시작한 다음 세부 정보를 표시하는 명령:

`network interface check cluster-connectivity start`그리고 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*참고:* 실행하기 전에 몇 초 동안 기다리십시오. `show` 세부 정보를 표시하는 명령입니다.

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.모든 ONTAP 릴리스
--
모든 ONTAP 릴리스의 경우 다음을 사용할 수도 있습니다. `cluster ping-cluster -node <name>` 연결성을 확인하는 명령:

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====
. [[7단계]] 클러스터가 정상인지 확인합니다.
+
`cluster ring show`

+
모든 유닛은 마스터 유닛이거나 보조 유닛이어야 합니다.

. 그룹 1의 포트에 스위치리스 구성을 설정합니다.
+

IMPORTANT: 잠재적인 네트워크 문제를 방지하려면 그룹1에서 포트 연결을 끊었다가 가능한 한 빨리, 예를 들어 *20초 이내에* 연달아 다시 연결해야 합니다.

+
.. 그룹1의 포트에서 모든 케이블을 동시에 분리합니다.
+
다음 예에서 케이블은 각 노드의 포트 "e0a"에서 분리되고 클러스터 트래픽은 각 노드의 스위치와 포트 "e0b"를 통해 계속됩니다.

+
image::../media/tnsc_clusterswitch1_disconnected.PNG[ClusterSwitch1 연결이 끊겼습니다]

.. 그룹1의 포트를 서로 등지고 케이블로 연결합니다.
+
다음 예에서, 노드1의 "e0a"는 노드2의 "e0a"에 연결됩니다.

+
image::../media/tnsc_ports_e0a_direct_connection.PNG[포트 "e0a" 간 직접 연결]



. 스위치리스 클러스터 네트워크 옵션은 다음에서 전환됩니다. `false` 에게 `true` .  최대 45초가 걸릴 수 있습니다.  스위치리스 옵션이 설정되어 있는지 확인하세요. `true` :
+
`network options switchless-cluster show`

+
다음 예에서는 스위치리스 클러스터가 활성화되어 있음을 보여줍니다.

+
[listing]
----
cluster::*> network options switchless-cluster show
Enable Switchless Cluster: true
----
. 원격 클러스터 인터페이스의 연결성을 확인하세요.


[role="tabbed-block"]
====
.ONTAP 9.9.1 이상
--
당신은 사용할 수 있습니다 `network interface check cluster-connectivity` 클러스터 연결에 대한 접근성 검사를 시작한 다음 세부 정보를 표시하는 명령:

`network interface check cluster-connectivity start`그리고 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*참고:* 실행하기 전에 몇 초 동안 기다리십시오. `show` 세부 정보를 표시하는 명령입니다.

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.모든 ONTAP 릴리스
--
모든 ONTAP 릴리스의 경우 다음을 사용할 수도 있습니다. `cluster ping-cluster -node <name>` 연결성을 확인하는 명령:

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====

IMPORTANT: 다음 단계로 넘어가기 전에 그룹 1에서 백투백 연결이 제대로 작동하는지 확인하기 위해 최소 2분 동안 기다려야 합니다.

. [[step11]] 그룹 2의 포트에 대한 스위치리스 구성을 설정합니다.
+

IMPORTANT: 잠재적인 네트워크 문제를 방지하려면 그룹2에서 포트 연결을 끊었다가 가능한 한 빨리, 예를 들어 *20초 이내에* 연달아 다시 연결해야 합니다.

+
.. 그룹2의 포트에서 모든 케이블을 동시에 분리합니다.
+
다음 예에서는 각 노드의 포트 "e0b"에서 케이블이 분리되고, 클러스터 트래픽은 "e0a" 포트 간의 직접 연결을 통해 계속됩니다.

+
image::../media/tnsc_clusterswitch2_disconnected.PNG[ClusterSwitch2 연결이 끊겼습니다]

.. 그룹2의 포트를 서로 등지고 케이블로 연결합니다.
+
다음 예에서, 노드1의 "e0a"는 노드2의 "e0a"에 연결되고, 노드1의 "e0b"는 노드2의 "e0b"에 연결됩니다.

+
image::../media/tnsc_node1_and_node2_direct_connection.PNG[node1과 node2의 포트 간 직접 연결]







=== 3단계: 구성 확인

. 두 노드의 포트가 올바르게 연결되었는지 확인하세요.
+
`network device-discovery show -port _cluster_port_`

+
.예를 보여주세요
[%collapsible]
====
다음 예에서는 클러스터 포트 "e0a"와 "e0b"가 클러스터 파트너의 해당 포트에 올바르게 연결되어 있음을 보여줍니다.

[listing]
----
cluster::> net device-discovery show -port e0a|e0b
  (network device-discovery show)
Node/      Local  Discovered
Protocol   Port   Device (LLDP: ChassisID)  Interface  Platform
---------- ------ ------------------------- ---------- ----------
node1/cdp
           e0a    node2                     e0a        AFF-A300
           e0b    node2                     e0b        AFF-A300
node1/lldp
           e0a    node2 (00:a0:98:da:16:44) e0a        -
           e0b    node2 (00:a0:98:da:16:44) e0b        -
node2/cdp
           e0a    node1                     e0a        AFF-A300
           e0b    node1                     e0b        AFF-A300
node2/lldp
           e0a    node1 (00:a0:98:da:87:49) e0a        -
           e0b    node1 (00:a0:98:da:87:49) e0b        -
8 entries were displayed.
----
====
. 클러스터 LIF에 대한 자동 되돌리기를 다시 활성화합니다.
+
`network interface modify -vserver Cluster -lif * -auto-revert true`

. 모든 LIF가 집에 있는지 확인하세요. 몇 초 정도 걸릴 수 있습니다.
+
`network interface show -vserver Cluster -lif _lif_name_`

+
.예를 보여주세요
[%collapsible]
====
"Is Home" 열이 있는 경우 LIF가 되돌려졌습니다. `true` , 표시된 대로 `node1_clus2` 그리고 `node2_clus2` 다음 예에서:

[listing]
----
cluster::> network interface show -vserver Cluster -fields curr-port,is-home
vserver  lif           curr-port is-home
-------- ------------- --------- -------
Cluster  node1_clus1   e0a       true
Cluster  node1_clus2   e0b       true
Cluster  node2_clus1   e0a       true
Cluster  node2_clus2   e0b       true
4 entries were displayed.
----
====
+
클러스터 LIFS가 홈 포트로 돌아오지 않은 경우 로컬 노드에서 수동으로 되돌립니다.

+
`network interface revert -vserver Cluster -lif _lif_name_`

. 두 노드의 시스템 콘솔에서 노드의 클러스터 상태를 확인하세요.
+
`cluster show`

+
.예를 보여주세요
[%collapsible]
====
다음 예에서는 두 노드 모두의 epsilon이 표시됩니다. `false` :

[listing]
----
Node  Health  Eligibility Epsilon
----- ------- ----------- --------
node1 true    true        false
node2 true    true        false
2 entries were displayed.
----
====
. 원격 클러스터 인터페이스의 연결성을 확인하세요.


[role="tabbed-block"]
====
.ONTAP 9.9.1 이상
--
당신은 사용할 수 있습니다 `network interface check cluster-connectivity` 클러스터 연결에 대한 접근성 검사를 시작한 다음 세부 정보를 표시하는 명령:

`network interface check cluster-connectivity start`그리고 `network interface check cluster-connectivity show`

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity start*
----
*참고:* 실행하기 전에 몇 초 동안 기다리십시오. `show` 세부 정보를 표시하는 명령입니다.

[listing, subs="+quotes"]
----
cluster1::*> *network interface check cluster-connectivity show*
                                  Source           Destination      Packet
Node   Date                       LIF              LIF              Loss
------ -------------------------- ---------------- ---------------- -----------
node1
       3/5/2022 19:21:18 -06:00   node1_clus2      node2-clus1      none
       3/5/2022 19:21:20 -06:00   node1_clus2      node2_clus2      none
node2
       3/5/2022 19:21:18 -06:00   node2_clus2      node1_clus1      none
       3/5/2022 19:21:20 -06:00   node2_clus2      node1_clus2      none
----
--
.모든 ONTAP 릴리스
--
모든 ONTAP 릴리스의 경우 다음을 사용할 수도 있습니다. `cluster ping-cluster -node <name>` 연결성을 확인하는 명령:

`cluster ping-cluster -node <name>`

[listing, subs="+quotes"]
----
cluster1::*> *cluster ping-cluster -node local*
Host is node2
Getting addresses from network interface table...
Cluster node1_clus1 169.254.209.69 node1 e0a
Cluster node1_clus2 169.254.49.125 node1 e0b
Cluster node2_clus1 169.254.47.194 node2 e0a
Cluster node2_clus2 169.254.19.183 node2 e0b
Local = 169.254.47.194 169.254.19.183
Remote = 169.254.209.69 169.254.49.125
Cluster Vserver Id = 4294967293
Ping status:

Basic connectivity succeeds on 4 path(s)
Basic connectivity fails on 0 path(s)

Detected 9000 byte MTU on 4 path(s):
Local 169.254.47.194 to Remote 169.254.209.69
Local 169.254.47.194 to Remote 169.254.49.125
Local 169.254.19.183 to Remote 169.254.209.69
Local 169.254.19.183 to Remote 169.254.49.125
Larger than PMTU communication succeeds on 4 path(s)
RPC status:
2 paths up, 0 paths down (tcp check)
2 paths up, 0 paths down (udp check)
----
--
====
. [[step6]] 자동 케이스 생성을 억제한 경우 AutoSupport 메시지를 호출하여 다시 활성화하세요.
+
`system node autosupport invoke -node * -type all -message MAINT=END`

+
자세한 내용은 다음을 참조하세요. link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/How_to_suppress_automatic_case_creation_during_scheduled_maintenance_windows_-_ONTAP_9["NetApp KB 문서 1010449: 예약된 유지 관리 기간 동안 자동 케이스 생성을 억제하는 방법"^].

. 권한 수준을 다시 관리자로 변경합니다.
+
`set -privilege admin`


